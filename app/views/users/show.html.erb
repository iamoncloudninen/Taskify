<%= link_to "戻る", timeline_index_path %>
<% if @user.id == current_user.id %>
  <h1>マイページ</h1>
<% else %>
  <h1>プロフィール</h1>
<% end %>
<%= attachment_image_tag @user, :profile_image, fallback: "no_image.png" %>
<%= @user.username %>
<% if @user.id == current_user.id %>
  <%= @user.email %>
  <%= link_to "編集", edit_user_path(@user) %>
  <%= link_to 'アカウント削除', user_path(@user), method: :delete, data: { confirm: '本当に削除しますか？' } %>
<% end %>
<h2>投稿一覧</h2>
<% @timeline_posts.each do |post| %>
  <%= attachment_image_tag post.user, :profile_image, fallback: "no_image.png", size: "50x50" %>
  <%= post.user.username %>
  <% if @user.id == current_user.id %>
    <%= link_to timeline_path(post), method: :delete, data: { confirm: '本当に削除しますか？' } do %>
      <i class="fa fa-trash"></i>
    <% end %>
  <% end %>
  <p>コメント：<%= post.content %></p>
  <p>達成したタスク:</p>
  <ul>
    <% post.tasks.each do |task| %>
      <li><%= task.content %></li>
    <% end %>
    <% if post.images.attached? %>
      <div>
        <p>添付画像 :</p>
        <% post.images.each do |image| %>
          <%= image_tag url_for(image), alt: "添付画像" %>
        <% end %>
      </div>
    <% end %>
    <div>
      <%= button_to '頑張ったね', timeline_post_reactions_path(post), method: :post, class: "btn btn-primary" unless post.reactions.exists?(user: current_user) %>
      <%= button_to '頑張ったね取消', timeline_post_reaction_path(post, post.reactions.find_by(user: current_user)), method: :delete, class: "btn btn-secondary" if post.reactions.exists?(user: current_user) %>
      <span>頑張ったね数: <%= post.reactions.count %></span>
    </div>
  </ul>
<% end %>
